<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">
body { font-size: 16px; }
.cal_brief { text-align: center; }
.cal_brief td:first-child { background: inherit; }
.cal_brief td { background: #ccc; width: 5ex; padding: 2px; }
.cal_big { text-align: center; padding: 0; margin: 0; }
.cal_big td { padding: 0 2px; }
.cal_mon { text-align: center; }
.cal_mon th { font-size: small; padding: 0; margin: 0; }
.cal_mon td { background: #ccc; width: 5ex; height: 1.5em;
	padding: 2px; text-align: right; }
.cal_mon td[colspan] { background: inherit; }
.cal_mon sup { color: #F0F0F0; text-align: left; float: left;
	margin-top: -2pt; font-weight: bold; }
.cal_mon a { text-align: right; margin-left: -4em; float: right; }
</style>

<title>phc-discussions - Re: [PHC] Scripting memory (not so) high vs Catena in PHP (with
 optimizations)</title>


</head>

<BODY bgcolor="#E0E0E0" text="black" link="blue" alink="red" vlink="navy">



<TABLE bgcolor="white" width="100%" border="0" cellspacing="0" cellpadding="0">
<TR>
<TD width="39%">
<A HREF="http://lists.openwall.net">lists.openwall.net</A>
<TD width="1%" rowspan="3">&nbsp;
<TD width="60%" align="right" rowspan="3">
<A HREF="/">lists</A>&nbsp;
/&nbsp;
<A HREF="http://www.openwall.com/lists/announce/">announce</A>&nbsp;
<A HREF="http://www.openwall.com/lists/owl-users/">owl-users</A>&nbsp;
<A HREF="http://www.openwall.com/lists/owl-dev/">owl-dev</A>&nbsp;
<A HREF="http://www.openwall.com/lists/john-users/">john-users</A>&nbsp;
<A HREF="http://www.openwall.com/lists/john-dev/">john-dev</A>&nbsp;
<A HREF="http://www.openwall.com/lists/passwdqc-users/">passwdqc-users</A>&nbsp;
<A HREF="http://www.openwall.com/lists/yescrypt/">yescrypt</A>&nbsp;
<A HREF="http://www.openwall.com/lists/popa3d-users/">popa3d-users</A>&nbsp;
/&nbsp;
<A HREF="http://www.openwall.com/lists/oss-security/">oss-security</A>&nbsp;
<A HREF="http://www.openwall.com/lists/kernel-hardening/">kernel-hardening</A>&nbsp;
<A HREF="http://www.openwall.com/lists/musl/">musl</A>&nbsp;
<A HREF="http://www.openwall.com/lists/sabotage/">sabotage</A>&nbsp;
<A HREF="http://www.openwall.com/lists/tlsify/">tlsify</A>&nbsp;
<A HREF="http://www.openwall.com/lists/passwords/">passwords</A>&nbsp;
/&nbsp;
<A HREF="http://www.openwall.com/lists/crypt-dev/">crypt-dev</A>&nbsp;
<A HREF="http://www.openwall.com/lists/xvendor/">xvendor</A>&nbsp;
/&nbsp;
<A HREF="/bugtraq/">Bugtraq</A>&nbsp;
<A HREF="/full-disclosure/">Full-Disclosure</A>&nbsp;
<A HREF="/linux-kernel/">linux-kernel</A>&nbsp;
linux-<A HREF="/netdev/">netdev</A>&nbsp;
<A HREF="/linux-ext4/">linux-ext4</A>&nbsp;
<a href="/linux-hardening/">linux-hardening</a>&nbsp;
<a href="/linux-cve-announce/">linux-cve-announce</a>&nbsp;
<a href="/phc-discussions/">PHC</a>&nbsp;
<TR><TD>
<DIV><FONT SIZE="-2"><I>Open Source and information security mailing list archives</I></FONT></DIV>
<TR><TD>&nbsp;
</TABLE>

<TABLE bgcolor="#B4D0DC" width="100%" border="0" cellspacing="0" cellpadding="1">
<TR><TD>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2">
<TR><TD bgcolor="#ECF8FF">

<a href="https://hashsuite.openwall.net/android">
Hash Suite for Android: free password hash cracker in your pocket</a>


</TABLE>
</TABLE>


<a href="1">[&lt;prev]</a> <a href="3">[next&gt;]</a> <a href="../../../2014/01/12/9">[&lt;thread-prev]</a> <a href="3">[thread-next&gt;]</a> <a href=".">[day]</a> <a href="..">[month]</a> <a href="../..">[year]</a> <a href="../../..">[list]</a>
<pre style="white-space: pre-wrap">
Message-ID: &lt;1564351344.680851.1389603022884.open-xchange&#64;email.1and1.com&gt;
Date: Mon, 13 Jan 2014 02:50:22 -0600 (CST)
From: Steve Thomas &lt;steve&#64;...tu.com&gt;
To: discussions&#64;...sword-hashing.net
Subject: Re: [PHC] Scripting memory (not so) high vs Catena in PHP (with
 optimizations)

I attached a faster version of Catena.


&gt; On January 12, 2014 at 9:12 AM Solar Designer &lt;solar&#64;...nwall.com&gt; wrote:
&gt;
&gt; On Sat, Jan 11, 2014 at 09:09:11AM -0600, Steve Thomas wrote:
&gt; &gt; Current scripting memory (not so) high vs current Catena:
&gt; &gt; 2 MiB: 544 ms vs 2030 ms (3.73x)
&gt; &gt; 1 MiB: 249 ms vs 1040 ms (4.17x)
&gt; [...]
&gt; &gt; Optimized scripting memory (not so) high vs optimized Catena:
&gt; &gt; 2 MiB: 431 ms vs 995 ms (2.31x)
&gt; &gt; 1 MiB: 195 ms vs 499 ms (2.56x)
&gt;
&gt; I was getting ~560 ms for 10 hashes at 1 MiB on i7-4770K. Your Q9300 is
&gt; maybe up to twice slower, but you're reporting twice lower time. Yet if
&gt; it was for just one hash computation rather than 10, then it'd be much
&gt; lower. So I am puzzled.

Sorry about that those are single runs. Measured in code with microtime().
I averaged 7 calls and took the average of 3 runs. So your i7-4770K is
4.45x faster.


&gt; On i7-4770K, the speed at 1 MiB is 37 c/s for 1 instance, 136 c/s
&gt; cumulative for 8 concurrent instances. Can you benchmark it on your
&gt; system, including against your Catena scripts?

1 MiB, 4 concurrent instances:
Catena: 8.34 c/s
Catena-original: 4.21 c/s
smhkdf-v2: 28.1 c/s


&gt; &gt; Scripting memory (not so) high:
&gt; &gt; $ja = unpack('V', $x);
&gt; &gt; vs
&gt; &gt; $ja = unpack('V', substr($x, -4));
&gt;
&gt; I've included this change now. The reason for substr($x, -4) was to
&gt; prevent an optimized (non-PHP) implementation from prefetching the next
&gt; block a few steps (3 steps, I think) before completing the SHA-512
&gt; computation. But if this costs us too much in terms of PHP overhead,
&gt; let's omit it. Besides, such prefetching may be helpful for defensive
&gt; native code implementations as well.

At first that's why I thought you were doing that, but it's the exact opposite
of
what's happening:

h = g
g = f
f = e
e = d + temp1
d = c
c = b
b = a
a = temp1 + temp2

So the best choice is the first 4 bytes. You get the last value 3.25 rounds
prior
to finishing. temp1 only depends on e, f, g, h, and w[]. On round 74 (1-80) you
can calculate the next 4 temp1s then you have the last value. It's about "4"
rounds.


&gt; &gt; $v = array();
&gt;
&gt; BTW, if we do that, we can also discourage TMTO by random writes in the
&gt; last loop:
&gt;
&gt; <a href="http://www.openwall.com/lists/crypt-dev/2013/11/20/1">http://www.openwall.com/lists/crypt-dev/2013/11/20/1</a>
&gt;
&gt; I think the same is not easy to do on a string, where substr() can only
&gt; be used on the right hand side, right? We're lacking an equivalent of
&gt; Perl's vec() in PHP, right?

I believe so, but you could do this with reading and writing characters. Only
problem is this is slow.


&gt; I think PHP arrays are always associative (they use hash tables), which
&gt; means they're somewhat inefficient for our needs here. Right?

Correct, I don't know what they use to store arrays but it's order preserving.
If I had to guess it would be a b-tree with two extra pointers for next and
previous.
I was actually impressed with the speed of Catena in PHP. I thought it would
be much worse because of the use of arrays.
<span style="font-family: times;"><strong>Content of type "</strong>text/html<strong>" skipped</strong></span>

<span style="font-family: times;"><strong>Download attachment "</strong><a href="2/1" rel="nofollow" download>catena-sha512.php</a><strong>" of type "</strong>application/x-httpd-php<strong>" (4549 bytes)</strong></span>
</pre>
<p><a href="https://www.openwall.com/blists/">Powered by blists</a> - <a href="https://lists.openwall.net">more mailing lists</a>


<p>




</body>
</html>
